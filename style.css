@import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700;800&display=swap');

:root {
    --primary-color: #1DB954;
    --background-color: #121212;
    --surface-color: #181818;
    --text-color: #FFFFFF;
    --text-muted-color: #B3B3B3;
    --dark-grey: #282828;
    --medium-grey: #535353;
    --success-color: #28a745;
    --danger-color: #dc3545;
    --border-radius: 12px;
}

* { box-sizing: border-box; margin: 0; padding: 0; }

body {
    font-family: 'Montserrat', sans-serif;
    background-color: var(--background-color);
    color: var(--text-color);
    display: flex; flex-direction: column;
    height: 100dvh; /* dvh für mobile Viewport Höhe */
    overflow: hidden;
    -webkit-tap-highlight-color: transparent;
    touch-action: manipulation;
}
body.is-guest .guest-hidden { display: none !important; }
body:not(.is-guest) .is-guest { display: none !important; }

.app-background { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-image: radial-gradient(ellipse 80% 50% at 5% 95%, rgba(29, 185, 84, 0.2), transparent); z-index: -1; }
.app-header {
    width: 100%; padding: 15px 20px; z-index: 10;
    display: flex; align-items: center; justify-content: space-between; position: relative;
    border-bottom: 1px solid var(--dark-grey); /* Optional: Kleine Trennlinie */
}
.logo-container { position: absolute; left: 50%; transform: translateX(-50%); }
.logo-container h1 { font-size: 1.5rem; color: var(--primary-color); font-weight: 800; letter-spacing: 2px; }
body:has(#auth-screen.active) .app-header { display: none; }
.button-leave { background: none; border: none; font-size: 1.5rem; color: var(--text-muted-color); cursor: pointer; z-index: 1; padding: 5px; /* Klickbereich vergrößern */ }
.app-header .header-icons { display: flex; align-items: center; gap: 15px; } /* Container für rechte Icons/Infos */
.header-spots { font-size: 0.9rem; font-weight: 700; color: var(--primary-color); }

.screen {
    display: none; flex-grow: 1; flex-direction: column; align-items: center;
    justify-content: flex-start; padding: 20px; width: 100%; overflow-y: auto;
    opacity: 0; visibility: hidden; transition: opacity 0.3s ease-in-out, visibility 0.3s ease-in-out;
    -webkit-overflow-scrolling: touch; /* Flüssigeres Scrollen auf iOS */
}
#auth-screen { justify-content: center; }
.screen.active { display: flex; opacity: 1; visibility: visible; }

.container, .auth-container, .home-container, .lobby-container, .game-container {
    width: 100%; max-width: 450px; text-align: center;
    display: flex; flex-direction: column; gap: 20px; /* Einheitlicher Abstand */
}
.text-left { text-align: left; }
h2 { font-size: 1.8rem; margin-bottom: 10px; font-weight: 800; }
p { color: var(--text-muted-color); line-height: 1.5; margin-bottom: 15px; } /* Etwas weniger Abstand */

.button-primary, .button-secondary, .button-danger {
    display: inline-flex; align-items: center; justify-content: center; gap: 10px; padding: 12px 24px; border: none; border-radius: 50px;
    font-size: 1rem; /* Leicht größer */ font-weight: 700; cursor: pointer; text-decoration: none; width: 100%; transition: transform 0.1s ease, background-color 0.2s ease;
}
.button-primary:active, .button-secondary:active, .button-danger:active { transform: scale(0.97); }
.button-primary { background-color: var(--primary-color); color: var(--background-color); } /* Besserer Kontrast */
.button-primary:disabled { background-color: var(--medium-grey); color: var(--dark-grey); cursor: not-allowed; opacity: 0.7; }
.button-secondary { background-color: var(--dark-grey); color: var(--text-color); }
.button-danger { background-color: var(--danger-color); color: var(--text-color); }
.button-icon { background: var(--dark-grey); color: var(--text-muted-color); border: none; border-radius: 50%; width: 40px; height: 40px; font-size: 0.9rem; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: background-color 0.2s ease; flex-shrink: 0; }
.button-icon:hover { background-color: var(--medium-grey); }
.button-small { padding: 8px 16px; font-size: 0.9rem; width: auto; }
.button-select {
    width: 100%; padding: 12px 15px; background-color: var(--dark-grey); border: 1px solid var(--medium-grey); border-radius: 8px; /* Dünnerer Rand */
    color: var(--text-color); font-size: 1rem; text-align: left; font-family: 'Montserrat', sans-serif; cursor: pointer;
    white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
    transition: border-color 0.2s ease;
}
.button-select:hover { border-color: var(--primary-color); }

input, select.lobby-select, input.lobby-input { width: 100%; padding: 12px 15px; background-color: var(--dark-grey); border: 1px solid var(--medium-grey); border-radius: 8px; color: var(--text-color); font-size: 1rem; }
input:focus, select:focus { border-color: var(--primary-color); outline: none; }
input:-webkit-autofill, input:-webkit-autofill:hover, input:-webkit-autofill:focus, input:-webkit-autofill:active { -webkit-box-shadow: 0 0 0 30px var(--dark-grey) inset !important; -webkit-text-fill-color: var(--text-color) !important; }
.hidden { display: none !important; }

.home-logo-container h1 { font-size: 2.5rem; font-weight: 800; letter-spacing: 2px; color: var(--text-muted-color); margin-bottom: 20px; }
.auth-form { display: flex; flex-direction: column; gap: 15px; margin-top: 20px; } /* Mehr Abstand */
.auth-toggle-text { font-size: 0.9rem; margin-top: 15px; }
.auth-toggle-text a { color: var(--primary-color); text-decoration: none; font-weight: 700; }
.guest-mode-separator { display: flex; align-items: center; text-align: center; color: var(--text-muted-color); margin: 25px 0; } /* Mehr Abstand */
.guest-mode-separator::before, .guest-mode-separator::after { content: ''; flex: 1; border-bottom: 1px solid var(--medium-grey); }
.guest-mode-separator:not(:empty)::before { margin-right: .5em; } /* Mehr Abstand */
.guest-mode-separator:not(:empty)::after { margin-left: .5em; }

.home-container { justify-content: flex-start; }
.profile-section {
    display: flex; align-items: center; gap: 15px; width: 100%; /* Kleinerer Gap */
    padding: 15px; border-radius: var(--border-radius); /* Kleineres Padding */
    background-color: var(--surface-color); /* Hintergrund für die Box */
    /* border: 1px solid var(--dark-grey); */ /* Optionaler Rand */
}
.profile-picture { width: 50px; height: 50px; border-radius: 50%; background-color: var(--dark-grey); display: flex; align-items: center; justify-content: center; font-size: 1.5rem; color: var(--text-muted-color); flex-shrink: 0; border: none; cursor: pointer; }
.profile-info { text-align: left; flex-grow: 1; display: flex; flex-direction: column; justify-content: center; min-width: 0; gap: 4px; /* Kleinerer Gap */ }
.username-container { position: relative; display: flex; align-items: center; gap: 8px; cursor: pointer; }
.username-container h2 { margin-bottom: 0; /* white-space: nowrap; <-- Entfernt */ overflow: visible; /* Erlaubt Umbruch */ text-overflow: clip; /* Kein Ellipsis mehr nötig */ font-size: 1.4rem; line-height: 1.3; min-width: 0; }
.edit-icon { font-size: 0.8rem; color: var(--text-muted-color); flex-shrink: 0; }
.profile-title-button { background: none; border: none; padding: 0; cursor: pointer; text-align: left; }
.profile-title { font-size: 0.8rem; font-weight: 700; color: var(--primary-color); background: #1db95420; padding: 3px 8px; border-radius: 20px; display: inline-block; }
.profile-actions { margin-left: auto; display: flex; gap: 8px; align-items: center; } /* Icons anpassen */

.level-progress-container { background: none; border: none; padding: 0; width: 100%; cursor: pointer; text-align: left; margin-top: 5px; }
.level-text { font-size: 0.8rem; color: var(--text-muted-color); font-weight: 700; margin-bottom: 2px; display: block; }
.xp-bar { width: 100%; height: 6px; background-color: var(--dark-grey); border-radius: 3px; overflow: hidden; }
.xp-fill { width: 0%; height: 100%; background-color: var(--primary-color); border-radius: 3px; transition: width 0.5s ease-out; }
.xp-text { font-size: 0.7rem; color: var(--text-muted-color); margin-top: 3px; display: block; }

.stats-overview-card { background-color: var(--surface-color); padding: 15px 20px; border-radius: var(--border-radius); width: 100%; cursor: pointer; transition: transform 0.2s ease, background-color 0.2s ease; border: none; color: var(--text-color); font-family: 'Montserrat', sans-serif; }
.stats-overview-card:hover { background-color: var(--dark-grey); }
.stats-overview-card:active { transform: scale(0.98); }
.stats-overview-card h3 { margin: 0 0 15px 0; text-align: left; font-size: 1rem; color: var(--text-muted-color); }
.stats-grid-preview { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; }
.stats-grid-preview .stat-item .stat-value { font-size: 1.6rem; font-weight: 800; color: var(--primary-color); display: block; }
.stats-grid-preview .stat-item .stat-label { font-size: 0.7rem; color: var(--text-muted-color); text-transform: uppercase; }
.home-actions { display: flex; flex-direction: column; gap: 15px; width: 100%; margin-top: 20px; }

.corner-button { position: fixed; bottom: 20px; right: 20px; width: 50px; height: 50px; background-color: var(--dark-grey); color: var(--text-muted-color); border: none; border-radius: 50%; font-size: 1rem; z-index: 100; cursor: pointer; display: flex !important; align-items: center; justify-content: center; box-shadow: 0 4px 10px rgba(0,0,0,0.3); }

/* ... (Stats Screen, Item/Icon/Title Selection Screens bleiben ähnlich) ... */
.stats-full-grid, .icon-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 15px; }
.stat-card, .title-card, .icon-card { /* ... */ }
.title-card.locked, .icon-card.locked { /* ... */ }
.title-card.locked::after, .icon-card.locked::after { /* ... */ }
.title-card:not(.locked), .icon-card:not(.locked) { /* ... */ }
.title-card.equipped, .icon-card.equipped { /* ... */ }
.icon-card .icon-preview { /* ... */ }

/* Level Fortschritt */
.level-progress-list { display: flex; flex-direction: column; gap: 15px; }
.level-progress-item { background-color: var(--surface-color); border: 1px solid var(--dark-grey); border-radius: var(--border-radius); padding: 15px; }
.level-progress-item.unlocked { border-color: var(--primary-color); background-color: #1db9541a; }
.level-progress-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
.level-progress-header h3 { margin: 0; font-size: 1.2rem; }
.level-progress-header span { font-size: 0.9rem; color: var(--text-muted-color); }
.level-progress-rewards { display: flex; flex-direction: column; gap: 10px; align-items: flex-start; }
.reward-item { display: flex; align-items: center; gap: 10px; background-color: var(--dark-grey); padding: 8px 12px; border-radius: 8px; }
.reward-item i { font-size: 1rem; color: var(--primary-color); width: 20px; text-align: center;}
.reward-item span { font-size: 0.9rem; font-weight: 700; }
.no-reward { font-size: 0.8rem; color: var(--text-muted-color); font-style: italic;}


/* ... (Game Screen, Mode Selection, Game Type Selection bleiben ähnlich) ... */

/* Lobby Screen */
.lobby-container { /* ... */ }
.lobby-header { /* ... */ }
.lobby-players-container { width: 100%; text-align: left; }
.lobby-players-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
.player-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 10px; /* Kleinerer Gap */ }
.player-card { background-color: var(--dark-grey); padding: 12px; border-radius: var(--border-radius); display: flex; align-items: center; gap: 10px; position: relative; overflow: hidden;}
.player-card.new { animation: slideIn 0.5s ease-out forwards; }
.player-card.disconnected::after { content: 'Offline'; /* ... */ }
@keyframes slideIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
.player-card .player-icon { font-size: 1.2rem; /* Kleiner */ }
.player-card .player-icon.host { color: var(--primary-color); }
.player-card .player-name { font-weight: 700; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; font-size: 0.9rem; }
#host-settings { margin-top: 20px; padding-top: 20px; border-top: 1px solid var(--dark-grey); width: 100%; display: flex; flex-direction: column; gap: 15px; }
#host-settings h3 { text-align: left; margin-bottom: 5px; font-size: 1.1rem; color: var(--text-muted-color); }
.settings-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px; } /* Grid für Einstellungen */
.setting { text-align: left; display: flex; flex-direction: column; gap: 8px; }
.setting label { display: flex; align-items: center; gap: 8px; font-size: 0.9rem; color: var(--text-muted-color); }
.help-icon { color: var(--medium-grey); cursor: help; }
.preset-group { display: flex; gap: 8px; width: 100%; flex-wrap: wrap; }
.preset-button { flex: 1 1 auto; background-color: var(--dark-grey); border: 1px solid var(--medium-grey); color: var(--text-muted-color); padding: 8px 10px; border-radius: 8px; font-weight: 700; cursor: pointer; transition: all 0.2s ease; min-width: 50px; font-size: 0.8rem; text-align: center; }
.preset-button:hover { border-color: var(--primary-color); }
.preset-button.active { background-color: var(--primary-color); border-color: var(--primary-color); color: var(--background-color); }
.button-start { padding: 15px; font-size: 1.1rem; }

/* ### START FEHLENDER BLOCK ### */
/* KORREKTUR: Die gesamten Modal-Styles haben gefehlt */
.modal-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.7); /* Dunkler Overlay */
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 1000;
    opacity: 0;
    visibility: hidden;
    transition: opacity 0.3s ease, visibility 0.3s ease;
    padding: 20px;
}
/* :not(.hidden) statt .active, um mit deinem JS zu funktionieren */
.modal-overlay:not(.hidden) {
    opacity: 1;
    visibility: visible;
}
.modal {
    background-color: var(--surface-color);
    padding: 25px;
    border-radius: var(--border-radius);
    width: 100%;
    max-width: 450px; /* Passt zum restlichen Layout */
    text-align: left;
    position: relative;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
    transform: scale(0.95);
    transition: transform 0.3s ease;
}
.modal-overlay:not(.hidden) .modal {
    transform: scale(1);
}
.modal h2 {
    margin-top: 0;
    margin-bottom: 20px;
    text-align: center; /* Zentriert im Modal-Header */
}
.button-exit-modal {
    position: absolute;
    top: 10px;
    right: 15px;
    background: none;
    border: none;
    font-size: 2rem;
    color: var(--text-muted-color);
    cursor: pointer;
    line-height: 1;
    padding: 5px;
}
/* ### ENDE FEHLENDER BLOCK ### */

/* ... (Loading Overlay, Countdown bleiben gleich) ... */

/* Freunde Modal */
.friends-modal .tabs { /* ... */ }
.friends-modal .tab-button { /* ... */ }
.friends-modal .tab-content { /* ... */ }
.friends-modal .add-friend-form { /* ... */ }
.friends-modal ul { list-style: none; display: flex; flex-direction: column; gap: 10px; max-height: 40vh; overflow-y: auto; padding-right: 5px; }
.friends-modal li { display: flex; align-items: center; justify-content: space-between; background-color: var(--dark-grey); padding: 10px 15px; border-radius: 8px; }
.friends-modal .friend-info { text-align: left; }
.friends-modal .friend-status { font-size: 0.8rem; color: var(--text-muted-color); }
.friends-modal .friend-status.online { color: var(--primary-color); font-weight: 700;}
.friends-modal .friend-actions { display: flex; gap: 8px; } /* Kleinerer Gap */
.friends-modal .friend-actions button { width: 35px; height: 35px; font-size: 0.9rem; padding: 0; } /* Sicherstellen, dass Icons passen */
.badge { /* ... */ }

/* ... (Invite Popup bleibt gleich) ... */

/* ... (On-Page Konsole bleibt gleich) ... */


/* ==================
   Spots & Shop Styles (NEU/Aktualisiert)
   ================== */

/* Spots Anzeige im Header */
.header-spots {
    font-size: 1rem; /* Größer im Header */
    font-weight: 700;
    color: var(--primary-color);
}
.header-spots span { font-weight: 800; }

/* Shop Screen */
#shop-screen .container { gap: 25px; }
.shop-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    border-bottom: 1px solid var(--dark-grey);
    padding-bottom: 10px;
    margin-bottom: 5px; /* Weniger Abstand nach Header */
}
.shop-header h2 { margin-bottom: 0; }
.shop-header .spots-display { font-size: 1.1rem; } /* Spots im Shop Header */

.shop-section { width: 100%; }
.shop-section h3 { margin-bottom: 15px; padding-bottom: 8px; color: var(--text-muted-color); font-size: 1.1rem; text-align: left; }
.shop-items-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 15px; }
.shop-items-grid.icon-grid { grid-template-columns: repeat(auto-fit, minmax(100px, 1fr)); }

.shop-item {
    background-color: var(--surface-color); padding: 15px; border-radius: var(--border-radius); text-align: center;
    border: 1px solid var(--dark-grey); /* Dezenterer Rand */
    display: flex; flex-direction: column; justify-content: space-between; gap: 8px;
    transition: transform 0.2s ease, box-shadow 0.2s ease; min-height: 190px; /* Mehr Höhe */
}
.shop-item:hover { transform: translateY(-4px); box-shadow: 0 6px 15px rgba(0,0,0,0.3); }

.shop-item.owned { opacity: 0.6; background-color: var(--dark-grey); pointer-events: none; }
.shop-item.owned .buy-button { background-color: var(--medium-grey); }
.shop-item.cannot-afford { border-left: 4px solid var(--danger-color); padding-left: 11px; } /* Markierung links */
.shop-item.cannot-afford .buy-button { opacity: 0.7; }

.shop-item .item-name { font-size: 1rem; font-weight: 700; color: var(--text-color); margin-bottom: 5px; }
.shop-item .item-description { font-size: 0.75rem; color: var(--text-muted-color); flex-grow: 1; margin-bottom: 10px; line-height: 1.4; }
.shop-item .item-cost { font-size: 1.1rem; font-weight: 800; color: var(--primary-color); margin-top: auto; }
.shop-item .buy-button { width: 100%; margin-top: 10px; font-size: 0.9rem; padding: 10px 15px; }
.shop-item .buy-button:disabled:not(.owned .buy-button) { background-color: var(--medium-grey); cursor: not-allowed; opacity: 0.7; } /* Styling für disabled (zu teuer) */


/* Shop Item Previews */
.shop-item .item-preview-icon { font-size: 2.5rem; margin: 5px 0 10px 0; color: var(--primary-color); line-height: 1; }
.shop-item .item-preview-background { width: 100%; padding-bottom: 56.25%; background-size: cover; background-position: center; border-radius: 8px; margin-bottom: 10px; border: 1px solid var(--dark-grey); background-color: var(--dark-grey); }


/* ==================
   Reaktionen & Gifting (Unverändert)
   ================== */
.reaction-buttons { display: flex; justify-content: center; flex-wrap: wrap; gap: 10px; margin: 20px auto 0 auto; max-width: 300px; }
.reaction-btn { font-size: 1.4rem; width: 45px; height: 45px; background-color: var(--dark-grey); transition: transform 0.1s ease; }
.reaction-btn:active { transform: scale(0.9); }
.player-reaction-popup { position: absolute; top: -15px; left: 50%; transform: translateX(-50%); font-size: 1.8rem; animation: floatUpAndFade 1.5s ease-out forwards; pointer-events: none; z-index: 10; text-shadow: 0 0 5px rgba(0,0,0,0.5); }
@keyframes floatUpAndFade { 0% { opacity: 1; transform: translate(-50%, 0); } 100% { opacity: 0; transform: translate(-50%, -40px); } }
.button-gift { color: var(--primary-color); width: 35px; height: 35px; font-size: 0.9rem; padding: 0; }

/* ==================
   Lobby Hintergrund (Unverändert)
   ================== */
#lobby-screen { background-image: none; background-size: cover; background-position: center; transition: background-image 0.5s ease-in-out; }
#background-select-modal-overlay .selection-list button.button-select { width: 100%; text-align: left; margin-bottom: 5px; }

/* Hilfsklasse für fehlende Belohnung im Level Fortschritt */
.no-reward {
     font-size: 0.8rem;
     color: var(--text-muted-color);
     font-style: italic;
     margin-left: 30px; /* Einrücken wie andere Belohnungen */
}

/* ### START HINZUGEFÜGTER BLOCK ### */
/* NEU: Styling für die Farbfelder im Shop */
.shop-item .item-preview-color {
    width: 100%;
    height: 80px; /* Höhe anpassen, wie du magst */
    border-radius: 8px;
    margin-bottom: 10px;
    border: 1px solid var(--dark-grey);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 2.5rem;
    color: rgba(255, 255, 255, 0.5); /* Icon-Farbe */
    text-shadow: 0 0 5px rgba(0,0,0,0.5);
    background-clip: padding-box; /* Stellt sicher, dass der Rand nicht übermalt wird */
}

/* FIX: Sorgt dafür, dass das Grid immer 2 Spalten hat,
   auch wenn nur 1 Item da ist (wie bei Consumables vorher) */
.shop-items-grid {
    grid-template-columns: repeat(2, 1fr);
}
/* ### ENDE HINZUGEFÜGTER BLOCK ### */
